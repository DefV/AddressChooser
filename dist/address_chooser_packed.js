if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.Proxy={};Mapeed.Proxy.GoogleMap=function(D,E,C){var A=this;function B(){A.map=new GMap2(D);A.map.setCenter(new GLatLng(47,1),1);A.geocoder=new GClientGeocoder;E.call(C,A.map)}if(typeof GMap2=="undefined"){if(typeof google=="undefined"){throw"Not google map object found, check if you have include google map javascript"}else{google.load("maps",2);google.setOnLoadCallback(B)}}else{B()}};Mapeed.Proxy.GoogleMap.prototype=(function(){function N(W,V,U,X){return GEvent.bindDom(W,V,U,X)}function O(U){GEvent.removeListener(U)}function P(U,W,V){this.geocoder.getLocations(U.join(", "),function(X){T(X,W,V)})}function K(){return this.map}function L(U){return U.address}function H(U){return B(U,"LocalityName")}function S(U){return B(U,"CountryName")}function F(U){return B(U,"PostalCodeName")}function J(U){return B(U,"ThoroughfareName")}function R(U){return U.Point.coordinates[1]}function M(U){return U.Point.coordinates[0]}function D(U){this.icon=U}function Q(X,W,Z,V){var a=X.AddressDetails.Accuracy,U=W?X.address.split(",").join("<br/>"):false,Y=1;if(a>=9){Y=17}else{if(a>=6){Y=14}else{if(a>=4){Y=12}else{if(a>1){Y=6}else{Y=3}}}}this.showMarker(X.Point.coordinates[1],X.Point.coordinates[0],Y,U,Z,V)}function A(a,W,Z,U,Y,V){var X=new GLatLng(a,W);this.map.setCenter(X,Z);if(this.marker){this.marker.setLatLng(X);this.marker.show()}else{this.marker=new GMarker(X,{draggable:true,icon:this.icon});GEvent.bind(this.marker,"dragstart",this,I);GEvent.bind(this.marker,"dragend",this,E);this.map.addOverlay(this.marker)}this.draggableCallback=Y;this.draggableContext=V;if(Y){this.marker.enableDragging()}else{this.marker.disableDragging()}if(U){this.marker.openInfoWindowHtml(U)}}function C(){if(this.marker){this.marker.closeInfoWindow();this.marker.hide()}}function G(U){var V=google&&google.loader?google.loader.ClientLocation:null;if(V){this.map.setCenter(new GLatLng(V.latitude,V.longitude),U||8)}}function T(U,W,V){if(U.Status.code==200){W.call(V,U.Placemark)}else{W.call(V,false)}}function I(){this.marker.closeInfoWindow()}function E(U){this.draggableCallback.call(this.draggableContext,U.lat(),U.lng())}function B(U,V){for(f in U){if(f==V){return U[f]}else{if(typeof U[f]=="object"){return B(U[f],V)}}}return""}return{addEventListener:N,removeEventListener:O,getMap:K,centerOnClientLocation:G,setIcon:D,getPlacemarks:P,showPlacemark:Q,showMarker:A,hidePlacemark:C,getLat:R,getLng:M,getAddress:L,getCity:H,getCountry:S,getZIP:F,getStreet:J}})();if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.AddressChooser={};Mapeed.AddressChooser.DefaultOptions={map:"map",street:"street",zip:"zip",city:"city",state:"state",country:"country",lat:"lat",lng:"lng",icon:null,auto:true,delay:300,showAddressOnMap:true,markerDraggable:true,mapProxy:Mapeed.Proxy.GoogleMap};Mapeed.AddressChooser.AddressKeys=["street","city","state","country","zip"],Mapeed.AddressChooser.AllKeys=Mapeed.AddressChooser.AddressKeys.concat("lat","lng");Mapeed.AddressChooser.Widget=function(A){function B(E){return E.tagName=="INPUT"?"keyup":"change"}function D(E,G){for(var F in G){E[F]=G[F]}return E}function C(){var F=this.options,I=Mapeed.AddressChooser.AllKeys;for(var H=I.length-1;H>=0;--H){var E=I[H];this[E]=document.getElementById(F[E])}if(!this.lat||!this.lng){throw"lat and lng are required fields"}if(F.auto){var J=function(K){this.updateMap(K,this.options.delay)},G=Mapeed.AddressChooser.AddressKeys;for(var H=G.length-1;H>=0;--H){var E=G[H];if(this[E]){this.mapProxy.addEventListener(this[E],B(this[E]),this,J)}}}this.callbacks.onInitialized(this)}this.options=D({},Mapeed.AddressChooser.DefaultOptions);D(this.options,A);this.callbacks={onSuggestsSearch:function(){},onSuggestsFound:function(){},onInitialized:function(){}};this.placemarks=[];this.mapProxy=new this.options.mapProxy(document.getElementById(this.options.map),C,this)};Mapeed.AddressChooser.Widget.prototype=(function(){function D(M){if(M.tagName=="INPUT"){return M.value}else{return M.options[M.selectedIndex].value}}function C(P,N){if(P){var O=P.keyCode;if(P.charCode||(O>0&&O<47&&O!=8&&O!=46)){return }}if(N){var M=this;if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){M.updateMap()},N||300)}else{this.callbacks.onSuggestsSearch(this);this.mapProxy.getPlacemarks(this.getCurrentAddress(),B,this)}}function E(N,O){if(this.lat.value&&this.lng.value){this.mapProxy.showMarker(this.lat.value,this.lng.value,O||5,N?this.getCurrentAddress().join("<br/>"):false,L,this)}else{var M=this.getCurrentAddress();if(M.length==0){this.centerOnClientLocation()}else{this.updateMap()}}}function I(M){if(this.placemarks&&M<this.placemarks.length){var N=this.placemarks[M];if(this.options.markerDraggable){this.mapProxy.showPlacemark(N,this.options.showAddressOnMap,L,this)}else{this.mapProxy.showPlacemark(N,this.options.showAddressOnMap)}this.lat.value=this.mapProxy.getLat(N);this.lng.value=this.mapProxy.getLng(N)}}function J(){var M=[],P=Mapeed.AddressChooser.AddressKeys;for(var O=P.length-1;O>=0;--O){var N=P[O];if(this[N]){var Q=D(this[N]);Q=Q.replace(/^\s+/,"").replace(/\s+$/,"");if(Q.length>0){M.unshift(Q)}}}return M}function G(){return this.mapProxy}function H(M){this.callbacks.onSuggestsFound=M;return this}function K(M){this.callbacks.onSuggestsSearch=M;return this}function A(M){this.callbacks.onInitialized=M;return this}function B(M){this.placemarks=M;if(M){this.showPlacemark(0)}else{this.lat.value="";this.lng.value="";this.mapProxy.hidePlacemark()}this.callbacks.onSuggestsFound(this,M)}function F(M){return function(){var N=arguments;return this.mapProxy[M].apply(this.mapProxy,arguments)}}function L(N,M){this.lat.value=N;this.lng.value=M}return{initMap:E,updateMap:C,showPlacemark:I,onInitialized:A,onSuggestsSearch:K,onSuggestsFound:H,getMapProxy:G,getCurrentAddress:J,getMap:F("getMap"),getCity:F("getCity"),getCountry:F("getCountry"),getZIP:F("getZIP"),getStreet:F("getStreet"),getAddress:F("getAddress"),setIcon:F("setIcon"),centerOnClientLocation:F("centerOnClientLocation")}})();