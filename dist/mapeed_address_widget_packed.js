if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.Proxy={};Mapeed.Proxy.GoogleMap=function(D,E,C){var A=this;function B(){A.map=new GMap2(D);A.map.setCenter(new GLatLng(47,1),1);A.geocoder=new GClientGeocoder;E.call(C,A.map)}if(typeof GMap2=="undefined"){if(typeof google=="undefined"){throw"Not google map object found, check if you have include google map javascript"}else{google.load("maps",2);google.setOnLoadCallback(B)}}else{B()}};Mapeed.Proxy.GoogleMap.prototype=(function(){function D(H,G,F,I){return GEvent.bindDom(H,G,F,I)}function C(F){return GEvent.removeListener(F)}function B(F,H,G){this.geocoder.getLocations(F.join(", "),function(I){E(I,H,G)})}function A(G,F){var H=new GLatLng(G.lat,G.lng);zoom=17;if(G.accuracy<7){zoom=10}if(G.accuracy<5){zoom=5}this.map.setCenter(H,zoom);if(this.gmarker){this.gmarker.setLatLng(H)}else{this.gmarker=new GMarker(H);this.map.addOverlay(this.gmarker)}if(F){this.gmarker.openInfoWindowHtml(G.address.split(",").join("<br/>"))}}function E(G,K,I){if(G.Status.code==200){var F=[];for(var H=0;H<G.Placemark.length;H++){var J=G.Placemark[H];F.push({lat:J.Point.coordinates[1],lng:J.Point.coordinates[0],address:J.address,accuracy:J.AddressDetails.Accuracy})}K.call(I,F)}else{K.call(I,false)}}return{addEventListener:D,removeEventListener:C,getPlacemarks:B,showPlacemark:A}})();if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.AddressForm={};Mapeed.AddressForm.$element=function $element(A){if(A instanceof Element){return A}else{return document.getElementById(A)}};Mapeed.AddressForm.DefaultOptions={map:"map",street:"street",city:"city",state:"state",country:"country",lat:"lat",lng:"lng",auto:false,delay:1000,showAddressOnMap:true,mapProxy:Mapeed.Proxy.GoogleMap};Mapeed.AddressForm.Widget=function(C){var A=Mapeed.AddressForm.$element;function B(D,F){for(var E in F){D[E]=F[E]}return D}this.options=B({},Mapeed.AddressForm.DefaultOptions);B(this.options,C);this.mapProxy=new this.options.mapProxy(A(this.options.map),this.initialize,this)};Mapeed.AddressForm.Widget.prototype=(function(){var I=Mapeed.AddressForm.$element,H=["street","city","state","country"],J=["lat","lng"];allKeys=["lat","lng","street","city","state","country"],function B(K){return K.tagName=="INPUT"?"keypress":"change"};function D(K){if(K.tagName=="INPUT"){return K.value}else{return K.options[K.selectedIndex].getAttribute("name")}}function F(){var L=this.options;for(var M=allKeys.length-1;M>=0;--M){var K=allKeys[M];this[K]=I(L[K])}if(!this.lat||!this.lng){throw"lat and lng are required fields"}if(L.auto){var N=function(){this.updateMap(this.options.delay)};for(var M=H.length-1;M>=0;--M){var K=H[M];if(this[K]){this.mapProxy.addEventListener(this[K],B(this[K]),this,N)}}}}function C(L){if(L){var K=this;if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){K.updateMap()},L)}else{this.mapProxy.getPlacemarks(this.getAddress(),A,this)}}function G(){var K=[];for(var M=H.length-1;M>=0;--M){var L=H[M];if(this[L]){var N=D(this[L]);N=N.replace(/^\s+/,"").replace(/\s+$/,"");if(N.length>0){K.unshift(N)}}}return K}function E(){return this.mapProxy}function A(K){if(K){this.mapProxy.showPlacemark(K[0],this.options.showAddressOnMap);this.lat.value=K[0].lat;this.lng.value=K[0].lng}}return{initialize:F,updateMap:C,getAddress:G,getMapProxy:E}})();