if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.Proxy={};Mapeed.Proxy.GoogleMap=function(D,E,C){var A=this;function B(){A.map=new GMap2(D);A.map.setCenter(new GLatLng(47,1),1);A.geocoder=new GClientGeocoder;E.call(C,A.map)}if(typeof GMap2=="undefined"){if(typeof google=="undefined"){throw"Not google map object found, check if you have include google map javascript"}else{google.load("maps",2);google.setOnLoadCallback(B)}}else{B()}};Mapeed.Proxy.GoogleMap.prototype=(function(){function M(V,U,T,W){return GEvent.bindDom(V,U,T,W)}function N(T){GEvent.removeListener(T)}function O(T,V,U){this.geocoder.getLocations(T.join(", "),function(W){S(W,V,U)})}function J(){return this.map}function K(T){return T.address}function G(T){return B(T,"LocalityName")}function R(T){return B(T,"CountryName")}function E(T){return B(T,"PostalCodeName")}function I(T){return B(T,"ThoroughfareName")}function Q(T){return T.Point.coordinates[1]}function L(T){return T.Point.coordinates[0]}function P(W,V,Y,U){var Z=W.AddressDetails.Accuracy,T=V?W.address.split(",").join("<br/>"):false,X=1;if(Z>=9){X=17}else{if(Z>=6){X=14}else{if(Z>=4){X=12}else{if(Z>1){X=6}else{X=3}}}}this.showMarker(W.Point.coordinates[1],W.Point.coordinates[0],X,T,Y,U)}function A(Z,V,Y,T,X,U){var W=new GLatLng(Z,V);this.map.setCenter(W,Y);if(this.marker){this.marker.setLatLng(W);this.marker.show()}else{this.marker=new GMarker(W,{draggable:true});GEvent.bind(this.marker,"dragstart",this,H);GEvent.bind(this.marker,"dragend",this,D);this.map.addOverlay(this.marker)}this.draggableCallback=X;this.draggableContext=U;if(X){this.marker.enableDragging()}else{this.marker.disableDragging()}if(T){this.marker.openInfoWindowHtml(T)}}function C(){if(this.marker){this.marker.closeInfoWindow();this.marker.hide()}}function F(T){var U=google&&google.loader?google.loader.ClientLocation:null;if(U){this.map.setCenter(new GLatLng(U.latitude,U.longitude),T||8)}}function S(T,V,U){if(T.Status.code==200){V.call(U,T.Placemark)}else{V.call(U,false)}}function H(){this.marker.closeInfoWindow()}function D(T){this.draggableCallback.call(this.draggableContext,T.lat(),T.lng())}function B(T,U){for(f in T){if(f==U){return T[f]}else{if(typeof T[f]=="object"){return B(T[f],U)}}}return""}return{addEventListener:M,removeEventListener:N,getMap:J,centerOnClientLocation:F,getPlacemarks:O,showPlacemark:P,showMarker:A,hidePlacemark:C,getLat:Q,getLng:L,getAddress:K,getCity:G,getCountry:R,getZIP:E,getStreet:I}})();if(typeof Mapeed=="undefined"){Mapeed={}}Mapeed.AddressChooser={};Mapeed.AddressChooser.$element=function $element(A){return document.getElementById(A)};Mapeed.AddressChooser.$extend=function(A,C){for(var B in C){A[B]=C[B]}return A};Mapeed.AddressChooser.DefaultOptions={map:"map",street:"street",zip:"zip",city:"city",state:"state",country:"country",lat:"lat",lng:"lng",auto:true,delay:300,showAddressOnMap:true,markerDraggable:true,mapProxy:Mapeed.Proxy.GoogleMap};Mapeed.AddressChooser.AddressKeys=["street","city","state","country","zip"],Mapeed.AddressChooser.AllKeys=Mapeed.AddressChooser.AddressKeys.concat("lat","lng");Mapeed.AddressChooser.Widget=function(C){function D(F){return F.tagName=="INPUT"?"keyup":"change"}function E(){var G=this.options,J=Mapeed.AddressChooser.AllKeys;for(var I=J.length-1;I>=0;--I){var F=J[I];this[F]=A(G[F])}if(!this.lat||!this.lng){throw"lat and lng are required fields"}if(G.auto){var K=function(L){this.updateMap(L,this.options.delay)},H=Mapeed.AddressChooser.AddressKeys;for(var I=H.length-1;I>=0;--I){var F=H[I];if(this[F]){this.mapProxy.addEventListener(this[F],D(this[F]),this,K)}}}this.callbacks.onInitialized(this)}var A=Mapeed.AddressChooser.$element,B=Mapeed.AddressChooser.$extend;this.options=B({},Mapeed.AddressChooser.DefaultOptions);B(this.options,C);this.callbacks={onSuggestsSearch:function(){},onSuggestsFound:function(){},onInitialized:function(){}};this.placemarks=[];this.mapProxy=new this.options.mapProxy(A(this.options.map),E,this)};Mapeed.AddressChooser.Widget.prototype=(function(){function D(M){if(M.tagName=="INPUT"){return M.value}else{return M.options[M.selectedIndex].value}}function C(P,N){if(P){var O=P.keyCode;if(P.charCode||(O>0&&O<47&&O!=8&&O!=46)){return }}if(N){var M=this;if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){M.updateMap()},N||300)}else{this.callbacks.onSuggestsSearch(this);this.mapProxy.getPlacemarks(this.getCurrentAddress(),B,this)}}function E(N,O){if(this.lat.value&&this.lng.value){this.mapProxy.showMarker(this.lat.value,this.lng.value,O||5,N?this.getCurrentAddress().join("<br/>"):false,L,this)}else{var M=this.getCurrentAddress();if(M.length==0){this.centerOnClientLocation()}else{this.updateMap()}}}function I(M){if(this.placemarks&&M<this.placemarks.length){var N=this.placemarks[M];if(this.options.markerDraggable){this.mapProxy.showPlacemark(N,this.options.showAddressOnMap,L,this)}else{this.mapProxy.showPlacemark(N,this.options.showAddressOnMap)}this.lat.value=this.mapProxy.getLat(N);this.lng.value=this.mapProxy.getLng(N)}}function J(){var M=[],P=Mapeed.AddressChooser.AddressKeys;for(var O=P.length-1;O>=0;--O){var N=P[O];if(this[N]){var Q=D(this[N]);Q=Q.replace(/^\s+/,"").replace(/\s+$/,"");if(Q.length>0){M.unshift(Q)}}}return M}function G(){return this.mapProxy}function H(M){this.callbacks.onSuggestsFound=M;return this}function K(M){this.callbacks.onSuggestsSearch=M;return this}function A(M){this.callbacks.onInitialized=M;return this}function B(M){this.placemarks=M;if(M){this.showPlacemark(0)}else{this.lat.value="";this.lng.value="";this.mapProxy.hidePlacemark()}this.callbacks.onSuggestsFound(this,M)}function F(M){return function(){var N=arguments;return this.mapProxy[M].apply(this.mapProxy,arguments)}}function L(N,M){this.lat.value=N;this.lng.value=M}return{initMap:E,updateMap:C,showPlacemark:I,onInitialized:A,onSuggestsSearch:K,onSuggestsFound:H,getMapProxy:G,getCurrentAddress:J,getMap:F("getMap"),getCity:F("getCity"),getCountry:F("getCountry"),getZIP:F("getZIP"),getStreet:F("getStreet"),getAddress:F("getAddress"),centerOnClientLocation:F("centerOnClientLocation")}})();