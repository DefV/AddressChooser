<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Basic example of Mapeed.AddressForm</title>
  <script src="http://maps.google.com/jsapi" type="text/javascript"></script>

	<script src="jquery/jquery.js" type="text/javascript"></script>
	<script src="jquery/jquery.autocomplete.js" type="text/javascript"></script>
	
	<script src="../src/googlemap.js" type="text/javascript"></script>
	<script src="../src/address_form.js" type="text/javascript"></script>
  <link href="basic.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="jquery/jquery.autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
</head>

<body>
  <form id='form' onsubmit='displayAddress(); return false;'>
    <label for='street'>Street</label>
    <input type='text' name='street' id='street' class='text' autocomplete='off'/>

    <label for='city'>City</label>
    <input type='text' name='city' id='city' class='text' autocomplete='off'/>
    
    <label for='country'>Country</label>
    <select  name='country' id='country'>
      <option value='France'>France</option>
      <option value='USA'>USA</option>
    </select>
    
    <input type='submit' value='Save' id='submit'/>
    
    <input type='hidden' name='lat' id='lat'/>
    <input type='hidden' name='lng' id='lng'/>
  </form>
  <div id='map_container'>
    <div id='map'></div>
    <input type='button' value='Display location on map' onclick='widget.updateMap();' id='view_on_map'/>
  </div>

  <script type='text/javascript'>
    
    widget = new Mapeed.AddressForm.Widget()
      .onSuggestsChanged(onSuggestsChanged)
      .onInitialized(onInitialized);
  
    function displayAddress() {
      alert(widget.getCurentAddress())
    }
  
    function onSuggestsChanged(widget, placemarks) {
      var data = [];
      for (var i = 0; i < placemarks.length; i++) {
        data.push([widget.getAddress(placemarks[i]), placemarks[i]]);
      }
      autocomplete.flushCache();
      autocomplete.setOptions({data: data});
      // Force display autocomplete suggest panel
      autocomplete.click();
    }
  
    function onInitialized(widget) {
      widget.getMap().addControl(new GSmallMapControl());
    }
    
    var autocomplete = $("#street").autocomplete([], {
  		minChars: 0,
  		max: 12,
  		autoFill: false,
  		matchContains: false,
  		scrollHeight: 220,
		  cacheLength: 0,
		  selectFirst: false
  	}).result(function(autocomplete, selected) {
      $('#city').val(widget.getCity(selected[1]));
      $('#street').val(widget.getStreet(selected[1]));
  	});
	  
  	$('#street').focus();
    
  </script>
</body>
</html>
