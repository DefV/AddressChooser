<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Autocomplete with script.aculo.us example of Mapeed.AddressChooser</title>
  <script src="http://maps.google.com/jsapi?key=ABQIAAAAPvuQxAHKdvs2AzUcIgAydBSQYJiLK5kLII1Jz3pe91PmWwG1FBQw5tPSjakIvA8TWMllIeMTDIBOMw" type="text/javascript"></script>
	<script src="prototype/prototype.js" type="text/javascript"></script>
	<script src="prototype/effects.js" type="text/javascript"></script>
	<script src="prototype/controls.js" type="text/javascript"></script>
	
	<script src="../src/googlemap.js" type="text/javascript"></script>
	<script src="../src/address_chooser.js" type="text/javascript"></script>
  <link href="basic.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="prototype/autocomplete.css" media="screen" rel="stylesheet" type="text/css" />
</head>

<body>
  <div id="header">
    <h1>Mapeed.AddressChooser / Basic example</h1>
  </div>
  <div id='container'>
    <p>
      This example uses Mapeed.AddressChooser.Widget with Prototype/Scriptaculous framework.
      Address is an autocomplete field filled by addresses returns by Google Map:
    </p>
    <ul>
      <li>Default options</li>
      <li>Callback on <em>onInitialized</em> to add maps controls</li>
      <li>Callback on <em>onSuggestsSearch</em> to display spinner on address field</li>
      <li>Callback on <em>onSuggestsFound</em> to remove spinner on address field and fill autocomplete</li>
    </ul>
    <p>
      Address string is sent to Google while you are typing (in fact you stop typing for one second) 
      and results are display automatically in the autocomplete.
    <p>
  </div>
  
  <div id="address_chooser">
  
    <form id='form' onsubmit='displayAddress(); return false;'>
      <label for='street'>Address</label>
      <input type='text' name='street' id='street' class='text' autocomplete='off'/>
      <div id='suggests' class='auto_complete' style='display:none'>
      </div>

      <label for='country'>Country</label>
      <select  name='country' id='country'>
        <option value='France'>France</option>
        <option value='USA'>USA</option>
      </select>
    
      <input type='submit' value='Save' id='submit'/>
    
      <input type='hidden' name='lat' id='lat'/>
      <input type='hidden' name='lng' id='lng'/>
    </form>
    <div id='map_container'>
      <div id='map'></div>
      <div id='map_tooltip'>
        drag marker to fix location
      </div>
    </div>
  <div class="clear"></div>
  </div>

  <div id='footer'>
    Under MIT licence - Provided by <a href='http://www.mapeed.com'>Mapeed</a>
  </div>

  <script type='text/javascript'>
      widget = new Mapeed.AddressChooser.Widget()
        .onSuggestsFound(onSuggestsFound)
        .onSuggestsSearch(onSuggestsSearch)
        .onInitialized(onInitialized);
  
      // Create a local autocomplete without data. Data will be added dynamically according to map suggestions
      var autocomplete = new Autocompleter.Local('street', 'suggests', [], {afterUpdateElement: afterUpdateElement});
      
      function displayAddress() {
        alert(widget.getCurrentAddress());
      }
  
      function afterUpdateElement(element, selectedElement) {
        var index = selectedElement.up().immediateDescendants().indexOf(selectedElement);
        widget.showPlacemark(index);
      }
      
      // Callback on suggest change
      function onSuggestsFound(widget, placemarks) {
        $('submit').disabled = false;
        $('street').removeClassName('spinner');
        $('street').focus();
        
        
        // Reset autocomplete suggestions to new placemarks
        autocomplete.options.array.clear()
        for (var i = 0; i < placemarks.length; i++) {
          autocomplete.options.array.push(widget.getAddress(placemarks[i]));
        }
        // For autocomplete update
        autocomplete.getUpdatedChoices();
        autocomplete.show();
      }
  
      function onSuggestsSearch(widget) {
        $('street').addClassName('spinner');
        $('submit').disabled = true;
      }
  
      function onInitialized(widget) {
        // Add some controls on map
        widget.getMap().addControl(new GSmallMapControl());
      }
    
      $('submit').disabled = true;
      $('street').focus();
      
  </script>
</body>
</html>
